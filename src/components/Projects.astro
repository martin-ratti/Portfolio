---
import { projects } from "../data/projects";
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import ProjectCard from "./ProjectCard.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const featuredProjects = projects.filter((p) => p.featured);
const otherProjects = projects.filter((p) => !p.featured);
---

<section id="proyectos" class="py-20 px-4 max-w-7xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold mb-16 text-center">
        <span class="text-gradient leading-relaxed py-2"
            >{t("projects.title")}</span
        >
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
        {
            featuredProjects.map((project, index) => (
                <ProjectCard
                    project={project}
                    index={index}
                    featured={true}
                    baseDelay={0}
                />
            ))
        }
    </div>

    <h3
        class="text-3xl font-bold mb-10 text-center text-slate-700 dark:text-slate-300"
    >
        {t("projects.other")}
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {
            otherProjects.map((project, index) => (
                <ProjectCard
                    project={project}
                    index={index}
                    featured={false}
                    baseDelay={featuredProjects.length * 0.1}
                />
            ))
        }
    </div>
</section>

<script>
    window.addEventListener("filter-projects", (e: Event) => {
        const customEvent = e as CustomEvent;
        const selectedSkill = customEvent.detail?.skill;
        const cards = document.querySelectorAll(".project-card");

        if (!selectedSkill) {
            cards.forEach((card) => {
                (card as HTMLElement).style.opacity = "1";
                (card as HTMLElement).style.filter = "grayscale(0)";
                (card as HTMLElement).style.transform = "scale(1)";
                (card as HTMLElement).style.borderColor = "transparent";
                (card as HTMLElement).style.zIndex = "0";
                (card as HTMLElement).style.boxShadow = "none";
            });
            return;
        }

        cards.forEach((card) => {
            const techs = JSON.parse(card.getAttribute("data-techs") || "[]");

            if (techs.includes(selectedSkill)) {
                (card as HTMLElement).style.opacity = "1";
                (card as HTMLElement).style.filter =
                    "grayscale(0) drop-shadow(0 0 15px rgba(139, 92, 246, 0.4))";
                (card as HTMLElement).style.transform = "scale(1.05)";
                (card as HTMLElement).style.borderColor =
                    "rgba(139, 92, 246, 0.8)";
                (card as HTMLElement).style.zIndex = "10";
            } else {
                (card as HTMLElement).style.opacity = "0.1";
                (card as HTMLElement).style.filter =
                    "grayscale(100%) blur(2px)";
                (card as HTMLElement).style.transform = "scale(0.95)";
                (card as HTMLElement).style.borderColor = "transparent";
                (card as HTMLElement).style.zIndex = "0";
                (card as HTMLElement).style.boxShadow = "none";
            }
        });
    });
</script>
